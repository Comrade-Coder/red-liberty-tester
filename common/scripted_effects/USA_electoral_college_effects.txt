### CONSTANTS ###
@PRESIDENTIAL_TIEBREAKER = 0.05

@MINIMUM_UNITY = 1
@MAXIMUM_UNITY = 30

@POPULARITY_CLAMP_MIN = 0 # used to be 0.001
@POPULARITY_CLAMP_MAX = 1000

@PULSE_POPULARITY_CLAMP_MIN = 0
@PULSE_POPULARITY_CLAMP_MAX_FIRST = 10
@PULSE_POPULARITY_CLAMP_MAX_SECOND = 2 # originally 2

### SENATORS ###
# 1 = socialist
# 2 = republican
# 3 = democrat
# 4 = afp
# 5 = communist
# 6 = farmer-labor # currently unused

USA_start_elections_system = {
	set_variable = { USA_campaigning_multiplier = 1 }

	every_owned_state = {
		limit = { can_have_elections_in_state = yes }
		
		set_variable = { communist_popularity = 0 }
		set_variable = { socialist_popularity = 0 }
		set_variable = { republican_popularity = 0 }
		set_variable = { democrat_popularity = 0 }
		set_variable = { commonwealth_popularity = 0 }
		
		clamp_variable = { #make sure to clamp any support variable that can change! 
   			var = communist_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		clamp_variable = { #make sure to clamp any support variable that can change! 
   			var = republican_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		clamp_variable = { #make sure to clamp any support variable that can change! 
   			var = democrat_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		clamp_variable = { #make sure to clamp any support variable that can change! 
   			var = socialist_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		clamp_variable = { #make sure to clamp any support variable that can change! 
   			var = commonwealth_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		
		set_variable = { state_communist_reps = 0 }
		set_variable = { state_socialist_reps = 0 }
		set_variable = { state_republican_reps = 0 }
		set_variable = { state_democrat_reps = 0 }
		set_variable = { state_afp_reps = 0 }
	}
	
	USA = {
		set_variable = { communist_electoral_votes = 0 }
		set_variable = { democrat_electoral_votes = 0 }
		set_variable = { republican_electoral_votes = 0 }
		set_variable = { socialist_electoral_votes = 0 }
		set_variable = { afp_electoral_votes = 0 }
	}
	
	367 = { # Alabama, extremely conservative, pro-segregation
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.05 }
		set_variable = { democrat_popularity = 0.7 }
		set_variable = { commonwealth_popularity = 0.25 }
		
		set_variable = { senator_1 = 3 } # democrat
		set_variable = { senator_2 = 4 } # afp
		
		set_variable = { state_democrat_reps = 7 }
		set_variable = { state_afp_reps = 3 }
		
		set_variable = { electoral_votes = 12 } # was 11
	}
	
	377 = { # Arizona, swing state
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.52 }
		set_variable = { democrat_popularity = 0.48 }
		
		set_variable = { senator_1 = 3 } # democrat
		set_variable = { senator_2 = 3 } # democrat
		
		set_variable = { state_socialist_reps = 1 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 5 } # was 3
	}
	
	372 = { # Arkansas
		set_state_flag = US_election_state
		set_variable = { democrat_popularity = 0.45 }
		set_variable = { commonwealth_popularity = 0.55 }
		
		set_variable = { senator_1 = 3 } # democrat
		set_variable = { senator_2 = 4 } # afp
		
		set_variable = { state_democrat_reps = 3 }
		set_variable = { state_afp_reps = 5 }
		
		set_variable = { electoral_votes = 10 } # was 9
	}
	
	378 = { # California, pretty messy state
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.55 }
		set_variable = { republican_popularity = 0.1 }
		set_variable = { democrat_popularity = 0.3 }
		set_variable = { afp_popularity = 0.05 }
		
		set_variable = { senator_1 = 1 } # socialist
		set_variable = { senator_2 = 1 } # socialist
		
		set_variable = { state_socialist_reps = 10 }
		set_variable = { state_republican_reps = 6 }
		set_variable = { state_democrat_reps = 4 }
		set_variable = { state_afp_reps = 1 }
		
		set_variable = { electoral_votes = 23 } # was 22
	}
	
	382 = { # Colorado, hot bed of radicalism
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.53 }
		set_variable = { democrat_popularity = 0.37 }
		set_variable = { commonwealth_popularity = 0.1 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 3 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 7 } # was 6
	}
	
	830 = { # Connecticut, significantly influenced by NY
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.1 }
		set_variable = { democrat_popularity = 0.43 }
		set_variable = { socialist_popularity = 0.47 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 3 }
		set_variable = { state_republican_reps = 1 }
		set_variable = { state_democrat_reps = 3 }
		
		set_variable = { electoral_votes = 9 } # was 8
	}
	
	833 = { # Delaware, slightly democrat
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.2 }
		set_variable = { democrat_popularity = 0.5 }
		set_variable = { socialist_popularity = 0.3 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_republican_reps = 1 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 4 } # was 3
	}
	
	366 = { # Florida, largely democrat, socialists popular in tampa
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.05 }
		set_variable = { democrat_popularity = 0.85 }
		set_variable = { commonwealth_popularity = 0.1 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { electoral_votes = 8 } # was 7
		
		set_variable = { state_socialist_reps = 1 }
		set_variable = { state_democrat_reps = 5 }
		
		set_state_flag = USA_gerrymandered_democrat
	}
	
	365 = { # Georgia, like Alabama, very pro-segregation
		set_state_flag = US_election_state
		set_variable = { democrat_popularity = 0.7 }
		set_variable = { commonwealth_popularity = 0.3 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { electoral_votes = 13 } # was 12
		
		set_variable = { state_democrat_reps = 10 }
		set_variable = { state_afp_reps = 1 }
		
		set_state_flag = USA_gerrymandered_democrat
	}
	
	387 = { # Idaho, potato state
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.52 }
		set_variable = { democrat_popularity = 0.48 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 5 } # was 4
	}
	
	395 = { # Illinois, core socialist state
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.7 }
		set_variable = { democrat_popularity = 0.25 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 19 }
		set_variable = { state_republican_reps = 2 }
		set_variable = { state_democrat_reps = 6 }
		set_variable = { state_afp_reps = 1 }
		
		set_variable = { electoral_votes = 30 } # was 29
	}
	
	396 = { # Indiana, solid republican state
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.47 }
		set_variable = { republican_popularity = 0.08 }
		set_variable = { democrat_popularity = 0.45 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 7 }
		set_variable = { state_republican_reps = 1 }
		set_variable = { state_democrat_reps = 4 }
		
		set_variable = { electoral_votes = 14 } # no change
	}
	
	392 = { # Iowa, favors the socialists for pro-agriculture stuff
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.8 }
		set_variable = { democrat_popularity = 0.2 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 8 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 12 } # was 11
	}
	
	383 = { # Kansas, same as Iowa, more republican leaning
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.47 }
		set_variable = { republican_popularity = 0.32 }
		set_variable = { democrat_popularity = 0.21 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_socialist_reps = 3 }
		set_variable = { state_republican_reps = 3 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 10 } # was 9
	}
	
	369 = { # Kentucky
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.25 }
		set_variable = { democrat_popularity = 0.7 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_republican_reps = 1 }
		set_variable = { state_democrat_reps = 6 }
		set_variable = { state_afp_reps = 1 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { electoral_votes = 12 } # was 11
	}
	
	371 = { # Louisiana, pro segregation, very conservative, afp stronghold
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.05 }
		set_variable = { democrat_popularity = 0.25 }
		set_variable = { commonwealth_popularity = 0.7 }
		
		set_variable = { senator_1 = 4 }
		set_variable = { senator_2 = 4 }
		
		set_variable = { state_democrat_reps = 1 }
		set_variable = { state_afp_reps = 7 }
		
		set_variable = { electoral_votes = 10 } # no change
	}
	
	827 = { # Maine, republican
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.1 }
		set_variable = { republican_popularity = 0.57 }
		set_variable = { democrat_popularity = 0.33 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_republican_reps = 3 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 6 } # was 5
	}
	
	361 = { # Maryland, good establishment place
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.14 }
		set_variable = { republican_popularity = 0.31 }
		set_variable = { democrat_popularity = 0.55 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_socialist_reps = 1 }
		set_variable = { state_republican_reps = 3 }
		set_variable = { state_democrat_reps = 3 }
		
		set_variable = { electoral_votes = 9 } # was 8
	}
	
	357 = { # Massachusetts, home of many famous liberals, though old money is still holding strong
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.3 }
		set_variable = { republican_popularity = 0.5 }
		set_variable = { democrat_popularity = 0.55 }
		set_variable = { commonwealth_popularity = 0.15 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 5 }
		set_variable = { state_republican_reps = 6 }
		set_variable = { state_democrat_reps = 5 }
		
		set_variable = { electoral_votes = 18 } # was 17
	}
	
	393 = { # Michigan, strong union and anti-segregationist sentiment in Detroit, Black Legion in the countryside
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.58 }
		set_variable = { republican_popularity = 0.17 }
		set_variable = { democrat_popularity = 0.22 }
		set_variable = { commonwealth_popularity = 0.03 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_socialist_reps = 10 }
		set_variable = { state_republican_reps = 4 }
		set_variable = { state_democrat_reps = 3 }
		set_variable = { state_afp_reps = 1 }
		
		set_variable = { electoral_votes = 20 } # was 19
	}
	
	391 = { # Minnesota, domain of the farmer-labor party
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.8 }
		set_variable = { democrat_popularity = 0.2 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 8 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 12 } # was 11
		
		set_state_flag = socialist_farmer_labor
		set_state_flag = USA_gerrymandered_socialist
	}
	
	370 = { # Mississippi, pro-segregation
		set_state_flag = US_election_state
		set_variable = { commonwealth_popularity = 0.29 }
		set_variable = { democrat_popularity = 0.71 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_democrat_reps = 6 }
		set_variable = { state_afp_reps = 2 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { electoral_votes = 10 } # was 9
	}
	
	373 = { # Missouri, st. louis is socialist, countryside is conservative
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.16 }
		set_variable = { republican_popularity = 0.14 }
		set_variable = { democrat_popularity = 0.7 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_republican_reps = 2 }
		set_variable = { state_democrat_reps = 10 }
		
		set_variable = { electoral_votes = 16 } # was 15
	}
	
	388 = { # Montana, heavily unionized
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.86 }
		set_variable = { democrat_popularity = 0.14 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 3 }
		
		set_variable = { electoral_votes = 5 } # was 4
	}
	
	384 = { # Nebraska, basically Kansas
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.34 }
		set_variable = { socialist_popularity = 0.36 }
		set_variable = { democrat_popularity = 0.25 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_republican_reps = 2 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 8 } # was 7
	}
	
	379 = { # Nevada, heavily influenced by neighbors, local silver mines
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.45 }
		set_variable = { democrat_popularity = 0.55 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 1 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 4 } # was 3
	}
	
	828 = { # New Hampshire
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.51 }
		set_variable = { democrat_popularity = 0.42 }
		set_variable = { socialist_popularity = 0.07 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_republican_reps = 2 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 5 } # was 4
	}
	
	359 = { # New Jersey
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.09 }
		set_variable = { democrat_popularity = 0.4 }
		set_variable = { socialist_popularity = 0.51 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_socialist_reps = 8 }
		set_variable = { state_republican_reps = 2 }
		set_variable = { state_democrat_reps = 5 }
		
		set_variable = { electoral_votes = 17 } # was 4, shouldve been 16
	}
	
	376 = { # New Mexico, swing state
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.46 }
		set_variable = { democrat_popularity = 0.41 }
		set_variable = { commonwealth_popularity = 0.03 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 5 } # was 3
	}
	
	358 = { # New York, very socialist
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.04 }
		set_variable = { socialist_popularity = 0.52 }
		set_variable = { republican_popularity = 0.11 }
		set_variable = { democrat_popularity = 0.33 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_communist_reps = 3 }
		set_variable = { state_socialist_reps = 26 }
		set_variable = { state_republican_reps = 9 }
		set_variable = { state_democrat_reps = 12 }
		
		set_variable = { electoral_votes = 52 } # was 47
	}
	
	363 = { # North Carolina, conservative but not super conservative
		set_state_flag = US_election_state
		set_variable = { democrat_popularity = 0.81 }
		set_variable = { commonwealth_popularity = 0.19 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_democrat_reps = 10 }
		set_variable = { state_afp_reps = 2 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { electoral_votes = 14 } # was 13
	}
	
	389 = { # North Dakota, core socialist state, controlled by the socialist nonpartisan league
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.66 }
		set_variable = { democrat_popularity = 0.34 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 5 } # was 4
		
		set_state_flag = socialist_nonpartisan_league
	}
	
	261 = { # Ohio, swing state
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.45 }
		set_variable = { socialist_popularity = 0.6 }
		set_variable = { democrat_popularity = 0.35 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_socialist_reps = 15 }
		set_variable = { state_republican_reps = 6 }
		set_variable = { state_democrat_reps = 3 }
		
		set_variable = { electoral_votes = 26 } # no change
	}
	
	374 = { # Oklahoma, tossup between left and right
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.52 }
		set_variable = { democrat_popularity = 0.43 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 5 }
		set_variable = { state_democrat_reps = 3 }
		set_variable = { state_afp_reps = 1 }
		
		set_variable = { electoral_votes = 11 } # no change
	}
	
	385 = { # Oregon
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.65 }
		set_variable = { democrat_popularity = 0.11 }
		set_variable = { commonwealth_popularity = 0.24 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 3 }
		set_variable = { state_afp_reps = 1 }
		
		set_variable = { electoral_votes = 6 } # was 5
	}
	
	360 = { # Pennsylvania, firmly socialist because of pittsburgh and philly
		set_state_flag = US_election_state
		set_variable = { socialist_popularity = 0.6 }
		set_variable = { republican_popularity = 0.17 }
		set_variable = { democrat_popularity = 0.2 }
		set_variable = { commonwealth_popularity = 0.03 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 21 }
		set_variable = { state_republican_reps = 6 }
		set_variable = { state_democrat_reps = 7 }
		set_variable = { state_afp_reps = 1 }
		
		set_variable = { electoral_votes = 37 } # was 36
	}
	
	831 = { # Rhode Island
		set_state_flag = US_election_state
		set_variable = { republican_popularity = 0.41 }
		set_variable = { commonwealth_popularity = 0.02 }
		set_variable = { democrat_popularity = 0.57 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_republican_reps = 1 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 5 } # was 4
	}
	
	364 = { # South Carolina
		set_state_flag = US_election_state
		set_variable = { democrat_popularity = 0.68 }
		set_variable = { commonwealth_popularity = 0.32 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { state_democrat_reps = 5 }
		set_variable = { state_afp_reps = 2 }
		
		set_variable = { electoral_votes = 9 } # was 8
	}
	
	390 = { # South Dakota, North Dakota part 2
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { socialist_popularity = 0.6 }
		set_variable = { republican_popularity = 0.35 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 5 } # was 4
	}
	
	368 = { # Tennessee
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { republican_popularity = 0.15 }
		set_variable = { democrat_popularity = 0.55 }
		set_variable = { commonwealth_popularity = 0.3 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_democrat_reps = 10 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { electoral_votes = 12 } # was 11
	}
	
	375 = { # Texas, Southern but not too Southern
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { socialist_popularity = 0.05 }
		set_variable = { republican_popularity = 0.1 }
		set_variable = { democrat_popularity = 0.45 }
		set_variable = { commonwealth_popularity = 0.35 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 4 }
		
		set_variable = { state_republican_reps = 2 }
		set_variable = { state_democrat_reps = 10 }
		set_variable = { state_afp_reps = 9 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { electoral_votes = 23 } # no change
	}
	
	380 = { # Utah, MORMON GANG
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { socialist_popularity = 0.1 }
		set_variable = { republican_popularity = 0.25 }
		set_variable = { democrat_popularity = 0.7 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_republican_reps = 1 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 5 } # was 4
	}
	
	829 = { # Vermont
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { socialist_popularity = 0.1 }
		set_variable = { republican_popularity = 0.55 }
		set_variable = { democrat_popularity = 0.3 }
		set_variable = { commonwealth_popularity = 0.05 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 2 }
		
		set_variable = { state_republican_reps = 2 }
		
		set_variable = { electoral_votes = 4 } # was 3
	}
	
	362 = { # Virginia
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { republican_popularity = 0.35 }
		set_variable = { democrat_popularity = 0.55 }
		set_variable = { socialist_popularity = 0.1 }
		
		set_variable = { senator_1 = 3 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 2 }
		set_variable = { state_democrat_reps = 8 }
		
		set_state_flag = USA_gerrymandered_democrat
		
		set_variable = { electoral_votes = 12 } # was 11
	}
	
	386 = { # Washington
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { republican_popularity = 0.25 }
		set_variable = { democrat_popularity = 0.35 }
		set_variable = { socialist_popularity = 0.7 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 5 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 8 } # no change
	}
	
	832 = { # West Virginia
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { republican_popularity = 0.2 }
		set_variable = { democrat_popularity = 0.35 }
		set_variable = { socialist_popularity = 0.65 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 3 }
		
		set_variable = { state_socialist_reps = 5 }
		set_variable = { state_democrat_reps = 2 }
		
		set_variable = { electoral_votes = 9 } # was 8
	}
	
	394 = { # Wisconsin, cheese and socialism
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { socialist_popularity = 0.9 }
		set_variable = { democrat_popularity = 0.2 }
		set_variable = { republican_popularity = 0.15 }
		
		set_variable = { senator_1 = 1 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 10 }
		set_variable = { state_democrat_reps = 1 }
		
		set_variable = { electoral_votes = 13 } # was 12
	}
	
	381 = { # Wyoming
		set_state_flag = US_election_state
		set_variable = { communist_popularity = 0.001 }
		set_variable = { socialist_popularity = 0.7 }
		set_variable = { republican_popularity = 0.1 }
		set_variable = { democrat_popularity = 0.2 }
		
		set_variable = { senator_1 = 2 }
		set_variable = { senator_2 = 1 }
		
		set_variable = { state_socialist_reps = 1 }
		set_variable = { state_republican_reps = 1 }
		
		set_variable = { electoral_votes = 4 } # was 3
	}
	
	USA_calculate_senators = yes
	USA_calculate_reps = yes
	log = "US Presidential Election System Initialization Complete"
}

USA_puerto_rico_create_state = {
	686 = {
		add_core_of = USA
		remove_core_of = PUE
	}
	
	hidden_effect = {
		686 = { # Puerto Rico, swing state
			set_state_flag = US_election_state
			set_variable = { socialist_popularity = 0.55 }
			set_variable = { republican_popularity = 0 }
			set_variable = { democrat_popularity = 0.5 }
			set_variable = { commonwealth_popularity = 0.1 }
			
			set_variable = { senator_1 = 1 } # socialist
			set_variable = { senator_2 = 3 } # democrat
			
			set_variable = { electoral_votes = 8 }
		}
		360 = {
			subtract_from_variable = { electoral_votes = 1 }
		}
		372 = {
			subtract_from_variable = { electoral_votes = 1 }
		}
		378 = {
			subtract_from_variable = { electoral_votes = 1 }
		}
		383 = {
			subtract_from_variable = { electoral_votes = 1 }
		}
		392 = {
			subtract_from_variable = { electoral_votes = 1 }
		}
		395 = {
			subtract_from_variable = { electoral_votes = 1 }
		}
		
		USA_calculate_senators = yes
	}
	
	log = "[THIS.GetName] USA_puerto_rico_create_state = yes"
}

USA_calculate_senators = {
	USA = {
		set_variable = { senators_socialist = 0 }
		set_variable = { senators_republican = 0 }
		set_variable = { senators_democrat = 0 }
		set_variable = { senators_fascist = 0 }
		set_variable = { senators_communist = 0 }
	}
	every_owned_state = {
		limit = { has_state_flag = US_election_state }
		if = {
			limit = {
				check_variable = { senator_1 = 1 }
			}
			add_to_variable = { USA.senators_socialist = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_2 = 1 }
			}
			add_to_variable = { USA.senators_socialist = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_1 = 2 }
			}
			add_to_variable = { USA.senators_republican = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_2 = 2 }
			}
			add_to_variable = { USA.senators_republican = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_1 = 3 }
			}
			add_to_variable = { USA.senators_democrat = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_2 = 3 }
			}
			add_to_variable = { USA.senators_democrat = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_1 = 4 }
			}
			add_to_variable = { USA.senators_fascist = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_2 = 4 }
			}
			add_to_variable = { USA.senators_fascist = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_1 = 5 }
			}
			add_to_variable = { USA.senators_communist = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_2 = 5 }
			}
			add_to_variable = { USA.senators_communist = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_1 = 6 }
			}
			add_to_variable = { USA.senators_farmer_labor = 1 }
		}
		if = {
			limit = {
				check_variable = { senator_2 = 6 }
			}
			add_to_variable = { USA.senators_farmer_labor = 1 }
		}
	}
	USA = {
		set_variable = { senators_total = 0 }
		add_to_variable = { senators_total = senators_socialist }
		add_to_variable = { senators_total = senators_republican }
		add_to_variable = { senators_total = senators_democrat }
		add_to_variable = { senators_total = senators_fascist }
		add_to_variable = { senators_total = senators_communist }
	}
	
	log = "######### SENATOR TOTALS #########"
	log = "[This.GetName] : senators_communist - [?senators_communist]"
	log = "[This.GetName] : senators_republican - [?senators_republican]"
	log = "[This.GetName] : senators_democrat - [?senators_democrat]"
	log = "[This.GetName] : senators_democrat - [?senators_democrat]"
	log = "[This.GetName] : senators_fascist - [?senators_fascist]"
	log = "[This.GetName] : senators_total - [?senators_total]"
}

USA_calculate_reps = {
	USA = {
		set_variable = { representatives_communist = 0 }
		set_variable = { representatives_socialist = 0 }
		set_variable = { representatives_farmer_labor = 0 }
		set_variable = { representatives_republican = 0 }
		set_variable = { representatives_democrat = 0 }
		set_variable = { representatives_fascist = 0 }
	}
	every_owned_state = {
		limit = {
			can_have_elections_in_state = yes
		}
		add_to_variable = { USA.representatives_communist = state_communist_reps }
		add_to_variable = { USA.representatives_socialist = state_socialist_reps }
		add_to_variable = { USA.representatives_democrat = state_democrat_reps }
		add_to_variable = { USA.representatives_republican = state_republican_reps }
		add_to_variable = { USA.representatives_fascist = state_afp_reps }
	}
	USA = {
		set_variable = { representatives_total = 0 }
		add_to_variable = { representatives_total = representatives_communist }
		add_to_variable = { representatives_total = representatives_socialist }
		add_to_variable = { representatives_total = representatives_republican }
		add_to_variable = { representatives_total = representatives_democrat }
		add_to_variable = { representatives_total = representatives_fascist }
	}
	
	log = "######### REPRESENTATIVE TOTALS #########"
	log = "[This.GetName] : representatives_communist - [?representatives_communist]"
	log = "[This.GetName] : representatives_socialist - [?representatives_socialist]"
	log = "[This.GetName] : representatives_republican - [?representatives_republican]"
	log = "[This.GetName] : representatives_democrat - [?representatives_democrat]"
	log = "[This.GetName] : representatives_fascist - [?representatives_fascist]"
	log = "[This.GetName] : representatives_total - [?representatives_total]"
}

USA_hold_presidential_election = {
	set_variable = { democrat_electoral_votes = 0 }
	set_variable = { republican_electoral_votes = 0 }
	set_variable = { socialist_electoral_votes = 0 }
	set_variable = { afp_electoral_votes = 0 }
	
	every_owned_state = {
		limit = { has_state_flag = US_election_state }
		
		USA_clamp_state_popularities = yes
		
		clamp_variable = { #make sure to clamp any support variable that can change! 
   			var = communist_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		
		clamp_variable = {
   			var = socialist_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		
		if = {
			limit = {
				NOT = {
					ROOT = {
						has_country_flag = USA_republicans_ded
					}
				}
			}
			clamp_variable = {
				var = republican_popularity
				min = @POPULARITY_CLAMP_MIN
				max = @POPULARITY_CLAMP_MAX
			}
		}
		
		clamp_variable = {
   			var = democrat_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		
		clamp_variable = {
   			var = commonwealth_popularity
    		min = @POPULARITY_CLAMP_MIN
    		max = @POPULARITY_CLAMP_MAX
		}
		
		USA_convert_party_pop_percentage = yes
		USA_hold_presidential_election_in_state = yes
	}

	log = "US Presidential Election: SPA: [?socialist_electoral_votes] || DP: [?democrat_electoral_votes] || RP: [?republican_electoral_votes] || AFP: [?afp_electoral_votes]"
}

USA_clamp_state_popularities = {
	
	clamp_variable = {
		var = communist_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_FIRST
	}
	clamp_variable = {
		var = socialist_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_FIRST
	}
	clamp_variable = {
		var = republican_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_FIRST
	}
	clamp_variable = {
		var = democrat_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_FIRST
	}
	clamp_variable = {
		var = commonwealth_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_FIRST
	}
	if = {
		limit = {
			OR = {
				check_variable = { communist_popularity > @PULSE_POPULARITY_CLAMP_MAX_SECOND }
				check_variable = { socialist_popularity > @PULSE_POPULARITY_CLAMP_MAX_SECOND }
				check_variable = { republican_popularity > @PULSE_POPULARITY_CLAMP_MAX_SECOND }
				check_variable = { democrat_popularity > @PULSE_POPULARITY_CLAMP_MAX_SECOND }
				check_variable = { commonwealth_popularity > @PULSE_POPULARITY_CLAMP_MAX_SECOND }
			}
		}
		set_temp_variable = { divisor = communist_popularity }
		add_to_temp_variable = { divisor = socialist_popularity }
		add_to_temp_variable = { divisor = republican_popularity }
		add_to_temp_variable = { divisor = democrat_popularity }
		add_to_temp_variable = { divisor = commonwealth_popularity }
		divide_temp_variable = { divisor = @PULSE_POPULARITY_CLAMP_MAX_SECOND }
		
		divide_variable = { communist_popularity = divisor }
		divide_variable = { republican_popularity = divisor }
		divide_variable = { democrat_popularity = divisor }
		divide_variable = { socialist_popularity = divisor }
		divide_variable = { commonwealth_popularity = divisor }
	}
	clamp_variable = {
		var = communist_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_SECOND
	}
	clamp_variable = {
		var = republican_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_SECOND
	}
	clamp_variable = {
		var = democrat_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_SECOND
	}
	clamp_variable = {
		var = socialist_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_SECOND
	}
	clamp_variable = {
		var = commonwealth_popularity
		min = @PULSE_POPULARITY_CLAMP_MIN
		max = @PULSE_POPULARITY_CLAMP_MAX_SECOND
	}
	#log = "[This.GetName] : USA_clamp_state_popularities: SPA: [?socialist_popularity] || DP: [?democrat_popularity] || RP: [?republican_popularity] || AFP: [?commonwealth_popularity]"
}

USA_prepare_presidential_election = {
	set_country_flag = USA_presidential_elections
}

USA_convert_party_pop_percentage = {
	
	### log the previous value ###
	set_variable = { communist_prev_election_pop = communist_election_pop }
	set_variable = { socialist_prev_election_pop = socialist_election_pop }
	set_variable = { republican_prev_election_pop = republican_election_pop }
	set_variable = { democrat_prev_election_pop = democrat_election_pop }
	set_variable = { commonwealth_prev_election_pop = commonwealth_election_pop }
	
	#make party pop into percentages
	#convert temp party pops into percentages
	set_temp_variable = { communist_temp_pop = communist_popularity }
	set_temp_variable = { socialist_temp_pop = socialist_popularity }
	set_temp_variable = { republican_temp_pop = republican_popularity }
	set_temp_variable = { democrat_temp_pop = democrat_popularity }
	set_temp_variable = { afp_temp_pop = commonwealth_popularity }
	
	### adds special event popularity
	add_to_temp_variable = { communist_temp_pop = communist_popularity_special }
	add_to_temp_variable = { socialist_temp_pop = socialist_popularity_special }
	add_to_temp_variable = { republican_temp_pop = republican_popularity_special }
	add_to_temp_variable = { democrat_temp_pop = democrat_popularity_special }
	add_to_temp_variable = { afp_temp_pop = afp_popularity_special }
	
	### various bonuses/maluses
	USA_gerrymandering_bonus = yes
	USA_party_unity_bonus = yes
	
	### final calculations
	set_temp_variable = { total_party_pop = communist_temp_pop }
	add_to_temp_variable = { total_party_pop = socialist_temp_pop }
	add_to_temp_variable = { total_party_pop = republican_temp_pop }
	add_to_temp_variable = { total_party_pop = democrat_temp_pop }
	add_to_temp_variable = { total_party_pop = afp_temp_pop }
	
	divide_temp_variable = { communist_temp_pop = total_party_pop }
	divide_temp_variable = { socialist_temp_pop = total_party_pop }
	divide_temp_variable = { republican_temp_pop = total_party_pop }
	divide_temp_variable = { democrat_temp_pop = total_party_pop }
	divide_temp_variable = { afp_temp_pop = total_party_pop }

	### convert to non-temp variables
	set_variable = { communist_election_pop = communist_temp_pop }
	set_variable = { socialist_election_pop = socialist_temp_pop }
	set_variable = { republican_election_pop = republican_temp_pop }
	set_variable = { democrat_election_pop = democrat_temp_pop }
	set_variable = { commonwealth_election_pop = afp_temp_pop }
	
	#log = "[This.GetName] : communist_election_pop - [?communist_election_pop]"
	#log = "[This.GetName] : socialist_election_pop - [?socialist_election_pop]"
	#log = "[This.GetName] : republican_election_pop - [?republican_election_pop]"
	#log = "[This.GetName] : democrat_election_pop - [?democrat_election_pop]"
	#log = "[This.GetName] : commonwealth_election_pop - [?commonwealth_election_pop]"
	
	set_variable = { total_election_pop = communist_election_pop }
	add_to_variable = { total_election_pop = socialist_election_pop }
	add_to_variable = { total_election_pop = republican_election_pop }
	add_to_variable = { total_election_pop = democrat_election_pop }
	add_to_variable = { total_election_pop = commonwealth_election_pop }
	
	add_to_variable = { total_election_pop = -1 }
	
	### discrepancy check
	if = {
		limit = {
			NOT = {
				check_variable = { total_election_pop = 0 }
			}
		}
		
		if = {
			limit = {
				check_variable = { total_election_pop > 0 }
			}
			multiply_variable = { total_election_pop = -1 }
		}
		
		#log = "[This.GetName] : total_election_pop discrepancy found - [?total_election_pop]"
		
		if = {
			limit = {
				check_variable = { communist_election_pop > 0 }
			}
			add_to_variable = { communist_election_pop = total_election_pop }
		}
		else_if = {
			limit = {
				check_variable = { commonwealth_election_pop > 0 }
			}
			add_to_variable = { commonwealth_election_pop = total_election_pop }
		}
		else_if = {
			limit = {
				check_variable = { democrat_election_pop > 0 }
			}
			add_to_variable = { democrat_election_pop = total_election_pop }
		}
		else_if = {
			limit = {
				check_variable = { republican_election_pop > 0 }
			}
			add_to_variable = { republican_election_pop = total_election_pop }
		}
		else_if = {
			limit = {
				check_variable = { socialist_election_pop > 0 }
			}
			add_to_variable = { socialist_election_pop = total_election_pop }
		}
	}
	
	### Get how much it changed by ###
	subtract_from_variable = { communist_prev_election_pop = communist_election_pop }
	subtract_from_variable = { socialist_prev_election_pop = socialist_election_pop }
	subtract_from_variable = { republican_prev_election_pop = republican_election_pop }
	subtract_from_variable = { democrat_prev_election_pop = democrat_election_pop }
	subtract_from_variable = { commonwealth_prev_election_pop = commonwealth_election_pop }
	
	### flip it and reverse it ###
	multiply_variable = { communist_prev_election_pop = -1 }
	multiply_variable = { socialist_prev_election_pop = -1 }
	multiply_variable = { republican_prev_election_pop = -1 }
	multiply_variable = { democrat_prev_election_pop = -1 }
	multiply_variable = { commonwealth_prev_election_pop = -1 }
	
	log = "[This.GetName] : communist_prev_election_pop - [?communist_prev_election_pop]"
	log = "[This.GetName] : socialist_prev_election_pop - [?socialist_prev_election_pop]"
	log = "[This.GetName] : republican_prev_election_pop - [?republican_prev_election_pop]"
	log = "[This.GetName] : democrat_prev_election_pop - [?democrat_prev_election_pop]"
	log = "[This.GetName] : commonwealth_prev_election_pop - [?commonwealth_prev_election_pop]"
	
	USA_state_generate_list = yes
}

USA_hold_presidential_election_in_state = {
	
	#check which party is largest
	if = {
		limit = {
			check_variable = { socialist_election_pop > republican_election_pop }
			check_variable = { socialist_election_pop > democrat_election_pop }
			check_variable = { socialist_election_pop > commonwealth_election_pop }
		}
		add_to_variable = { ROOT.socialist_electoral_votes = electoral_votes }
		add_to_variable = { ROOT.socialist_states_taken = 1 }
		log = "[This.GetName] : Voted for socialists with [?electoral_votes] electoral votes"
		set_state_flag = voted_socialist
	}
	else_if = {
		limit = {
			check_variable = { republican_election_pop > democrat_election_pop }
			check_variable = { republican_election_pop > commonwealth_election_pop }
			check_variable = { republican_election_pop > socialist_election_pop }
		}
		add_to_variable = { ROOT.republican_electoral_votes = electoral_votes }
		add_to_variable = { ROOT.republican_states_taken = 1 }
	    log = "[This.GetName] : Voted for republicans with [?electoral_votes] electoral votes"
		set_state_flag = voted_republican
		
		if = {
			limit = {
				USA = {
					has_country_flag = USA_democratic_republican_coalition
				}
			}
			subtract_from_variable = { ROOT.republican_electoral_votes = electoral_votes }
			add_to_variable = { ROOT.democrat_electoral_votes = electoral_votes }
			
			subtract_from_variable = { ROOT.republican_states_taken = 1 }
			add_to_variable = { ROOT.democrat_states_taken = 1 }
			
			log = "[This.GetName] : Vote was changed to democrats with [?electoral_votes] electoral votes"
			clr_state_flag = voted_republican
			set_state_flag = voted_democrat
		}
	}
	else_if = {
		limit = {
			check_variable = { democrat_election_pop > republican_election_pop }
			check_variable = { democrat_election_pop > commonwealth_election_pop }
			check_variable = { democrat_election_pop > socialist_election_pop }
		}
		add_to_variable = { ROOT.democrat_electoral_votes = electoral_votes }
		add_to_variable = { ROOT.democrat_states_taken = 1 }
		log = "[This.GetName] : Voted for democrats with [?electoral_votes] electoral votes"
		set_state_flag = voted_democrat
	}
	else_if = {
		limit = {
			check_variable = { commonwealth_election_pop > republican_election_pop }
			check_variable = { commonwealth_election_pop > democrat_election_pop }
			check_variable = { commonwealth_election_pop > socialist_election_pop }
		}
		add_to_variable = { ROOT.afp_electoral_votes = electoral_votes }
		add_to_variable = { ROOT.afp_states_taken = 1 }
		log = "[This.GetName] : Voted for afp with [?electoral_votes] electoral votes"
		set_state_flag = voted_afp
	}
	else = {
		random_list = {
			50 = {
				add_to_variable = { ROOT.socialist_electoral_votes = electoral_votes }
				log = "[This.GetName] : Voted for socialists with [?electoral_votes] electoral votes"
				set_state_flag = voted_socialist
			}
			50 = {
				add_to_variable = { ROOT.democrat_electoral_votes = electoral_votes }
				log = "[This.GetName] : Voted for democrats with [?electoral_votes] electoral votes"
				set_state_flag = voted_democrat
			}
		}
	}
}

clear_election_results = {
	every_owned_state = {
		limit = {
			can_have_elections_in_state = yes
		}
		set_variable = { democrat_electoral_votes = 0 }
		set_variable = { republican_electoral_votes = 0 }
		set_variable = { socialist_electoral_votes = 0 }
		set_variable = { afp_electoral_votes = 0 }
		
		clr_state_flag = voted_socialist
		clr_state_flag = voted_republican
		clr_state_flag = voted_democrat
		clr_state_flag = voted_afp
		
		set_variable = { socialist_popularity_special = 0 }
		set_variable = { republican_popularity_special = 0 }
		set_variable = { democrat_popularity_special = 0 }
		set_variable = { afp_popularity_special = 0 }
	}
	set_variable = { democrat_electoral_votes = 0 }
	set_variable = { republican_electoral_votes = 0 }
	set_variable = { socialist_electoral_votes = 0 }
	set_variable = { afp_electoral_votes = 0 }
	
	set_variable = { socialist_states_taken = 0 }
	set_variable = { republican_states_taken = 0 }
	set_variable = { democrat_states_taken = 0 }
	set_variable = { afp_states_taken = 0 }
	
	log = "[This.GetName] : election results cleared"
}

USA_clear_presidential_election_values = {
	clr_country_flag = USA_presidential_conclusion
	clr_country_flag = USA_presidential_elections
	clr_country_flag = currently_campaigning
}

USA_kill_republican_party = {
	# we do a little trolling
	
	set_country_flag = USA_republicans_ded
	
	every_owned_state = {
		limit = {
			can_have_elections_in_state = yes
		}
		set_variable = { republican_popularity = 0 }
		set_variable = { republican_election_pop = 0 }
	}
	
	USA_recalculate_polls = yes
}

USA_gerrymandering_bonus = {
	if = {
		limit = {
			has_state_flag = USA_gerrymandered_democrat
		}
		add_to_temp_variable = { democrat_temp_pop = 0.05 }
		#log = "[This.GetName] : added USA_gerrymandered_democrat bonus"
	}
	else_if = {
		limit = {
			has_state_flag = USA_gerrymandered_socialist
		}
		add_to_temp_variable = { socialist_temp_pop = 0.05 }
		#log = "[This.GetName] : added USA_gerrymandered_socialist bonus"
	}
	else_if = {
		limit = {
			has_state_flag = USA_gerrymandered_afp
		}
		add_to_temp_variable = { afp_temp_pop = 0.05 }
		#log = "[This.GetName] : added USA_gerrymandered_afp bonus"
	}
}

USA_party_unity_bonus = {
	clamp_variable = {
		var = USA.USA_socialist_unity
		min = @MINIMUM_UNITY
		max = @MAXIMUM_UNITY
	}

	if = {
		limit = {
			check_variable = { USA.USA_socialist_unity < 5 }
		}
		subtract_from_temp_variable = { socialist_temp_pop = 0.1 }
		#log = "[This.GetName] : added USA_party_unity_bonus -0.1"
	}
	else_if = {
		limit = {
			check_variable = { USA.USA_socialist_unity < 10 }
		}
		subtract_from_temp_variable = { socialist_temp_pop = 0.075 }
		#log = "[This.GetName] : added USA_party_unity_bonus -0.075"
	}
	else_if = {
		limit = {
			check_variable = { USA.USA_socialist_unity < 15 }
		}
		subtract_from_temp_variable = { socialist_temp_pop = 0.05 }
		#log = "[This.GetName] : added USA_party_unity_bonus -0.05"
	}
	else_if = {
		limit = {
			check_variable = { USA.USA_socialist_unity > 25 }
		}
		add_to_temp_variable = { socialist_temp_pop = 0.05 }
		#log = "[This.GetName] : added USA_party_unity_bonus +0.05"
	}
}

USA_setup_candidate_popularity = {
	
	every_owned_state = {
		limit = {
			can_have_elections_in_state = yes
		}
		set_variable = { popularity_candidate_1 = 0.5 }
		set_variable = { popularity_candidate_2 = 0.5 }
		
		USA_add_homestate_advantage = yes
		
		log = "[THIS.GetName]: popularity_candidate_1 - [?popularity_candidate_1], popularity_candidate_2 - [?popularity_candidate_2]"
	}
}

USA_add_homestate_advantage = {
	if = {
		limit = {
			check_variable = { THIS.id = 261.id } # ohio
			USA = {
				has_country_flag = USA_thomas_renominated
			}
		}
		add_to_variable = { popularity_candidate_1 = 0.1 }
		subtract_from_variable = { popularity_candidate_2 = 0.1 }
	}
	else_if = {
		limit = {
			check_variable = { THIS.id = 370.id } # mississippi
			USA = {
				has_country_flag = USA_lister_candidate
			}
		}
		add_to_variable = { popularity_candidate_2 = 0.1 }
		subtract_from_variable = { popularity_candidate_1 = 0.1 }
	}
}

USA_state_generate_list = {
	
	clear_array = THIS.party_array
	clear_array = THIS.socialist_faction_array
	clear_array = THIS.democrat_faction_array
	clear_array = THIS.republican_faction_array
	clear_array = THIS.commonwealth_faction_array
	
	# Parties #
	if = {
		limit = {
			check_variable = { communist_election_pop > 0 }
		}
		add_to_array = { party_array = token:communist_group_popularity }
		set_variable = { percentage@token:communist_group_popularity = communist_election_pop }
	}
	if = {
		limit = {
			check_variable = { socialist_election_pop > 0 }
		}
		add_to_array = { party_array = token:socialist_group_popularity }
		set_variable = { percentage@token:socialist_group_popularity = socialist_election_pop }
	}
	if = {
		limit = {
			check_variable = { democrat_election_pop > 0 }
		}
		add_to_array = { party_array = token:democrat_group_popularity }
		set_variable = { percentage@token:democrat_group_popularity = democrat_election_pop }
	}
	if = {
		limit = {
			check_variable = { republican_election_pop > 0 }
		}
		add_to_array = { party_array = token:republican_group_popularity }
		set_variable = { percentage@token:republican_group_popularity = republican_election_pop }
	}
	if = {
		limit = {
			check_variable = { commonwealth_election_pop > 0 }
		}
		add_to_array = { party_array = token:commonwealth_group_popularity }
		set_variable = { percentage@token:commonwealth_group_popularity = commonwealth_election_pop }
	}
	
	# Factions #
	#add_to_array = { socialist_faction_array = token:socialist_center_popularity }
	#set_variable = { percentage@token:socialist_center_popularity = 0.8 }
	#add_to_array = { socialist_faction_array = token:socialist_right_popularity }
	#set_variable = { percentage@token:socialist_right_popularity = 0.2 }
	#add_to_array = { democrat_faction_array = token:democrat_liberal_popularity }
	#set_variable = { percentage@token:democrat_liberal_popularity = 0.4 }
	#add_to_array = { democrat_faction_array = token:democrat_conservative_popularity }
	#set_variable = { percentage@token:democrat_conservative_popularity = 0.6 }
}
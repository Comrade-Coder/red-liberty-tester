keep_current_politics = { # use before puppeting to keep ideology after
	
	set_variable = { save_anarchism = party_popularity@anarchism }
	set_variable = { save_vanguard_socialism = party_popularity@vanguard_socialism }
	set_variable = { save_revolutionary_socialism = party_popularity@revolutionary_socialism }
	set_variable = { save_democratic_socialism = party_popularity@democratic_socialism }
	set_variable = { save_social_democracy = party_popularity@social_democracy }
	set_variable = { save_progressive_liberalism = party_popularity@progressive_liberalism }
	set_variable = { save_liberal_conservatism = party_popularity@liberal_conservatism }
	set_variable = { save_national_conservatism = party_popularity@national_conservatism }
	set_variable = { save_authoritarian_democracy = party_popularity@authoritarian_democracy }
	set_variable = { save_despotism = party_popularity@despotism }
	set_variable = { save_ultraconservatism = party_popularity@ultraconservatism }
	set_variable = { save_fascism = party_popularity@fascism }

	multiply_variable = { save_anarchism = 100 }
	multiply_variable = { save_vanguard_socialism = 100 }
	multiply_variable = { save_revolutionary_socialism = 100 }
	multiply_variable = { save_democratic_socialism = 100 }
	multiply_variable = { save_social_democracy = 100 }
	multiply_variable = { save_progressive_liberalism = 100 }
	multiply_variable = { save_liberal_conservatism = 100 }
	multiply_variable = { save_national_conservatism = 100 }
	multiply_variable = { save_authoritarian_democracy = 100 }
	multiply_variable = { save_despotism = 100 }
	multiply_variable = { save_ultraconservatism = 100 }
	multiply_variable = { save_fascism = 100 }

	if = {
		limit = { has_government = anarchism }
		set_country_flag = { flag = was_anarchism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = vanguard_socialism }
		set_country_flag = { flag = was_vanguard_socialism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = revolutionary_socialism }
		set_country_flag = { flag = was_revolutionary_socialism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = democratic_socialism }
		set_country_flag = { flag = was_democratic_socialism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = social_democracy }
		set_country_flag = { flag = was_social_democracy value = 1 days = 1 }
	}
	if = {
		limit = { has_government = progressive_liberalism }
		set_country_flag = { flag = was_progressive_liberalism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = liberal_conservatism }
		set_country_flag = { flag = was_liberal_conservatism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = national_conservatism }
		set_country_flag = { flag = was_national_conservatism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = authoritarian_democracy }
		set_country_flag = { flag = was_authoritarian_democracy value = 1 days = 1 }
	}
	if = {
		limit = { has_government = despotism }
		set_country_flag = { flag = was_save_despotism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = ultraconservatism }
		set_country_flag = { flag = was_ultraconservatism value = 1 days = 1 }
	}
	if = {
		limit = { has_government = fascism }
		set_country_flag = { flag = was_fascism value = 1 days = 1 }
	}

	set_temp_variable = { total_ideology_score = 100 }
	subtract_from_temp_variable = { total_ideology_score = save_anarchism }
	subtract_from_temp_variable = { total_ideology_score = save_vanguard_socialism }
	subtract_from_temp_variable = { total_ideology_score = save_revolutionary_socialism }
	subtract_from_temp_variable = { total_ideology_score = save_democratic_socialism }
	subtract_from_temp_variable = { total_ideology_score = save_social_democracy }
	subtract_from_temp_variable = { total_ideology_score = save_progressive_liberalism }
	subtract_from_temp_variable = { total_ideology_score = save_liberal_conservatism }
	subtract_from_temp_variable = { total_ideology_score = save_national_conservatism }
	subtract_from_temp_variable = { total_ideology_score = save_authoritarian_democracy }
	subtract_from_temp_variable = { total_ideology_score = save_despotism }
	subtract_from_temp_variable = { total_ideology_score = save_ultraconservatism }
	subtract_from_temp_variable = { total_ideology_score = save_fascism }

	if = {
		limit = { NOT = { check_variable = { total_ideology_score = 0 } } }
		if = {
			limit = { has_government = anarchism }
			add_to_variable = { save_anarchism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = vanguard_socialism }
			add_to_variable = { save_vanguard_socialism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = revolutionary_socialism }
			add_to_variable = { save_revolutionary_socialism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = democratic_socialism }
			add_to_variable = { save_democratic_socialism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = social_democracy }
			add_to_variable = { save_social_democracy = total_ideology_score }
		}
		else_if = {
			limit = { has_government = progressive_liberalism }
			add_to_variable = { save_progressive_liberalism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = liberal_conservatism }
			add_to_variable = { save_liberal_conservatism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = national_conservatism }
			add_to_variable = { save_national_conservatism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = authoritarian_democracy }
			add_to_variable = { save_authoritarian_democracy = total_ideology_score }
		}
		else_if = {
			limit = { has_government = despotism }
			add_to_variable = { save_despotism = total_ideology_score }
		}
		else_if = {
			limit = { has_government = ultraconservatism }
			add_to_variable = { save_ultraconservatism = total_ideology_score }
		}
		else = {
			limit = { has_government = fascism }
			add_to_variable = { save_fascism = total_ideology_score }
		}
	}

	hidden_effect = { country_event = { id = politics_saver.1 hours = 1 } }
}

reset_government = {

	set_popularities = {
		anarchism = save_anarchism
		vanguard_socialism = save_vanguard_socialism
		revolutionary_socialism = save_revolutionary_socialism
		democratic_socialism = save_democratic_socialism
		social_democracy = save_social_democracy
		progressive_liberalism = save_progressive_liberalism
		liberal_conservatism = save_liberal_conservatism
		national_conservatism = save_national_conservatism
		authoritarian_democracy = save_authoritarian_democracy
		despotism = save_despotism
		ultraconservatism = save_ultraconservatism
		fascism = save_fascism
	}
	
	if = {
		limit = { has_country_flag = was_anarchism }
		set_politics = { ruling_party = anarchism }
	}
	if = {
		limit = { has_country_flag = was_vanguard_socialism }
		set_politics = { ruling_party = vanguard_socialism }
	}
	if = {
		limit = { has_country_flag = was_revolutionary_socialism }
		set_politics = { ruling_party = revolutionary_socialism }
	}
	if = {
		limit = { has_country_flag = was_democratic_socialism }
		set_politics = { ruling_party = democratic_socialism }
	}
	if = {
		limit = { has_country_flag = was_social_democracy }
		set_politics = { ruling_party = social_democracy }
	}
	if = {
		limit = { has_country_flag = was_progressive_liberalism }
		set_politics = { ruling_party = progressive_liberalism }
	}
	if = {
		limit = { has_country_flag = was_liberal_conservatism }
		set_politics = { ruling_party = liberal_conservatism }
	}
	if = {
		limit = { has_country_flag = was_national_conservatism }
		set_politics = { ruling_party = national_conservatism }
	}
	if = {
		limit = { has_country_flag = was_authoritarian_democracy }
		set_politics = { ruling_party = authoritarian_democracy }
	}
	if = {
		limit = { has_country_flag = was_despotism }
		set_politics = { ruling_party = despotism }
	}
	if = {
		limit = { has_country_flag = was_ultraconservatism }
		set_politics = { ruling_party = ultraconservatism }
	}
	if = {
		limit = { has_country_flag = was_fascism }
		set_politics = { ruling_party = fascism }
	}

	clear_variable = save_anarchism
	clear_variable = save_vanguard_socialism
	clear_variable = save_revolutionary_socialism
	clear_variable = save_democratic_socialism
	clear_variable = save_social_democracy
	clear_variable = save_progressive_liberalism
	clear_variable = save_liberal_conservatism
	clear_variable = save_national_conservatism
	clear_variable = save_authoritarian_democracy
	clear_variable = save_authoritarian_democracy
	clear_variable = save_ultraconservatism
	clear_variable = save_fascism
}

clr_opinion_modifiers = {
	every_other_country = {
		remove_opinion_modifier = {
			target = ROOT
			modifier = RL_similar_ideology_close
		}
		remove_opinion_modifier = {
			target = ROOT
			modifier = RL_similar_ideology
		}
		remove_opinion_modifier = {
			target = ROOT
			modifier = RL_similar_ideology_distant
		}
		remove_opinion_modifier = {
			target = ROOT
			modifier = RL_different_ideology_close
		}
		remove_opinion_modifier = {
			target = ROOT
			modifier = RL_different_ideology
		}
		remove_opinion_modifier = {
			target = ROOT
			modifier = RL_same_ideology
		}
		ROOT = {
			remove_opinion_modifier = {
				target = PREV
				modifier = RL_similar_ideology_close
			}
			remove_opinion_modifier = {
				target = PREV
				modifier = RL_similar_ideology
			}
			remove_opinion_modifier = {
				target = PREV
				modifier = RL_similar_ideology_distant
			}
			remove_opinion_modifier = {
				target = PREV
				modifier = RL_different_ideology_close
			}
			remove_opinion_modifier = {
				target = PREV
				modifier = RL_different_ideology
			}
			remove_opinion_modifier = {
				target = PREV
				modifier = RL_same_ideology
			}
		}
	}
}

setup_opinion_modifiers = {
	every_other_country = {
		if = {
			limit = { has_same_govt_as_PREV = yes }
			add_opinion_modifier = {
				target = PREV
				modifier = RL_same_ideology
			}
		}
		else_if = {
			limit = { has_similar_close_govt_to_PREV = yes }
			add_opinion_modifier = {
				target = PREV
				modifier = RL_similar_ideology_close
			}
		}
		else_if = {
			limit = { has_similar_govt_to_PREV = yes }
			add_opinion_modifier = {
				target = PREV
				modifier = RL_similar_ideology
			}
		}
		else_if = {
			limit = { has_similar_distant_govt_to_PREV = yes }
			add_opinion_modifier = {
				target = PREV
				modifier = RL_similar_ideology_distant
			}
		}
		else_if = {
			limit = { has_different_close_govt_to_PREV = yes }
			add_opinion_modifier = {
				target = PREV
				modifier = RL_different_ideology_close
			}
		}
		else = {
			add_opinion_modifier = {
				target = PREV
				modifier = RL_different_ideology
			}
		}
	}
}

update_opinion_modifiers = {
	every_other_country = {
		if = {
			limit = { has_same_govt_as_ROOT = yes }
			add_opinion_modifier = {
				target = ROOT
				modifier = RL_same_ideology
			}
			reverse_add_opinion_modifier = {
				target = ROOT
				modifier = RL_same_ideology
			}
		}
		else_if = {
			limit = { has_similar_close_govt_to_ROOT = yes }
			add_opinion_modifier = {
				target = ROOT
				modifier = RL_similar_ideology_close
			}
			reverse_add_opinion_modifier = {
				target = ROOT
				modifier = RL_similar_ideology_close
			}
		}
		else_if = {
			limit = { has_similar_govt_to_ROOT = yes }
			add_opinion_modifier = {
				target = ROOT
				modifier = RL_similar_ideology
			}
			reverse_add_opinion_modifier = {
				target = ROOT
				modifier = RL_similar_ideology
			}
		}
		else_if = {
			limit = { has_similar_distant_govt_to_ROOT = yes }
			add_opinion_modifier = {
				target = ROOT
				modifier = RL_similar_ideology_distant
			}
			reverse_add_opinion_modifier = {
				target = ROOT
				modifier = RL_similar_ideology_distant
			}
		}
		else_if = {
			limit = { has_different_close_govt_to_ROOT = yes }
			add_opinion_modifier = {
				target = ROOT
				modifier = RL_different_ideology_close
			}
			reverse_add_opinion_modifier = {
				target = ROOT
				modifier = RL_different_ideology_close
			}
		}
		else = {
			add_opinion_modifier = {
				target = ROOT
				modifier = RL_different_ideology
			}
			reverse_add_opinion_modifier = {
				target = ROOT
				modifier = RL_different_ideology
			}
		}
	}
}

improve_state_category = {
	if = {
		limit = { has_state_category = pastoral }
		set_state_category = rural
	}
	else_if = {
		limit = { has_state_category = rural }
		set_state_category = developing_rural
	}
	else_if = {
		limit = { has_state_category = developing_rural }
		set_state_category = town
	}
	else_if = {
		limit = { has_state_category = town }
		set_state_category = large_town
	}
	else_if = {
		limit = { has_state_category = large_town }
		set_state_category = city
	}
	else_if = {
		limit = { has_state_category = city }
		set_state_category = large_city
	}
	else_if = {
		limit = { has_state_category = large_city }
		set_state_category = metropolis
	}
	else_if = {
		limit = { has_state_category = metropolis }
		set_state_category = megalopolis
	}
}

add_potential_special_forces_tree = {
	custom_effect_tooltip = add_potential_special_forces_tree_tt
	if = {
		limit = { NOT = { has_variable = sf_trees } }
		set_variable = { sf_trees = 2 }
	}
	else = {
		add_to_variable = { sf_trees = 1 }
	}
}

remove_potential_special_forces_tree = {
	if = {
		limit = { NOT = { has_variable = sf_trees } }
		set_variable = { sf_trees = 0 }
	}
	else = {
		subtract_from_variable = { sf_trees = 1 }
	}
}

### Paratroopers
SF_PARA_sabotage_effect = { #When changing this, update the research tooltip
	damage_building = {
		type = infrastructure
		damage = 2
	}
	damage_building = {
		type = industrial_complex
		damage = 1
	}
	damage_building = {
		type = arms_factory
		damage = 1
	}
	set_state_flag = {
		flag = para_drop_effect
		days = 30
	}
}

SF_PARA_combat_effect = { #When changing this, update the research tooltip
	every_state_division = {
		limit = { 
			OWNER = { has_war_with = FROM }
		}
		set_unit_organization = 0.50
	}
	set_state_flag = {
		flag = para_drop_effect
		days = 30
	}
}

### Muuuurrrriiinnnnneeeeessssss
SF_marine_demoliton_effect = { #When changing this, update the research tooltip
	damage_building = {
		type = radar_station
		damage = 1
	}
	damage_building = {
		type = naval_base
		damage = 1
	}
	damage_building = {
		type = dockyard
		damage = 1
	}
	damage_building = {
		type = nuclear_reactor
		damage = 1
	}
	damage_building = {
		type = rocket_site
		damage = 1
	}
	damage_building = {
		type = fuel_silo
		damage = 1
	}
	set_state_flag = {
		flag = marines_commando_effect
		days = 30
	}
}

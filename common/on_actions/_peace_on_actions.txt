on_actions = {
	on_declare_war = {
		effect = {
			log = "[GetDateText]: [Root.GetName] declared war on [From.GetName]"
			ROOT = {
				set_country_flag = declared_war_on_@FROM
			}
		}
	}
	
	on_war_relation_added = {
		effect = {
			
		}
	}
	
	on_peace = {
		effect = {
			save_event_target_as = volunteer_target
			every_other_country = {
				limit = { has_country_flag = sent_volunteers_@event_target:volunteer_target }
				clr_country_flag = sent_volunteers_@event_target:volunteer_target
			}
		}
	}
	
	on_peaceconference_started = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_peaceconference_started"
		}
	}
	
	on_peaceconference_ended = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_peaceconference_ended"
		}
	}
	
	on_capitulation_immediate = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation_immediate"
		}
	}

	on_capitulation = {
		effect = {
			log = "[GetDateText]: FROM: [From.GetName] ROOT: [Root.GetName] on_capitulation"
			
			### PEACE POPUP ###
			set_global_flag = show_peace_popup_alert
			FROM = {
				save_global_event_target_as = winning_country
			}
			ROOT = {
				save_global_event_target_as = losing_country
			}
			
			log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] on_capitulation"
			
			if = {
				limit = {
					event_target:losing_country = {
						any_allied_country = {
							has_war_together_with = event_target:losing_country
						}
					}
				}
				set_global_flag = losing_country_multiple
			}
			if = {
				limit = {
					event_target:winning_country = {
						any_allied_country = {
							has_war_together_with = event_target:winning_country
						}
					}
				}
				set_global_flag = winning_country_multiple
			}
			
			if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = no }
						ROOT = {
							all_allied_country = {
								has_capitulated = yes
							}
						}
					}
					NOT = {
						has_game_rule = {
							rule = SCRIPTED_PEACE
							option = SCRIPTED_PEACE_DISABLED
						}
					}
				}
				set_global_flag = war_won
				
				log = "[GetDateText]: winner/loser: FROM: [winning_country.GetName] ROOT: [losing_country.GetName] war_won"
				
				### INDIAN-BURMESE WAR ###
				if = {
					limit = {
						FROM = {
							OR = {
								original_tag = RAJ
								original_tag = ENG
							}
						}
						ROOT = {
							original_tag = BRM
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					RAJ = {
						annex_country = {
							target = BRM
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### BRAZILIAN CIVIL WAR ###
				
				## Vargas Victory ##
				else_if = {
					limit = {
						FROM = {
							original_tag = BRA
						}
						ROOT = {
							original_tag = UOB
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					BRA = {
						annex_country = {
							target = UOB
						}
						country_event = {
							id = demo_bra.4
							days = 25
						}
						remove_ideas = {
							BRA_civil_war
							BRA_right_wing_coalition
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = demo_bra.1 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				
				## NLA Victory ##
				else_if = {
					limit = {
						FROM = {
							original_tag = UOB
						}
						ROOT = {
							original_tag = BRA
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					UOB = {
						annex_country = {
							target = BRA
						}
						country_event = {
							id = demo_uob.5
							days = 25
						}
						remove_ideas = {
							UOB_civil_war
							UOB_left_wing_coalition
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = demo_uob.1 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				
				### RUSSIAN CIVIL WAR ###
				
				## Soviet Victory ##
				else_if = {
					limit = {
						FROM = {
							original_tag = SOV
						}
						ROOT = {
							original_tag = RUS
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						annex_country = {
							target = FER
						}
						country_event = {
							id = demo_sov.2
							days = 15
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = demo_rus.4 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				
				## Russian Victory ##
				else_if = {
					limit = {
						FROM = {
							original_tag = RUS
						}
						ROOT = {
							original_tag = SOV
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = demo_rus.5 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = RUS
						}
						ROOT = {
							original_tag = FER
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
					}
					set_global_flag = skip_default_capitulation
				}
			
				### DANUBIAN WARS ###
				
				## Monarchist Victory ##
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = AUS
								is_ally_with = AUS
								is_in_faction_with = AUS
								is_subject_of = AUS
							}
						}
						ROOT = {
							original_tag = AHE
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					ROOT = {
						dismantle_faction = yes
					}
					AUS = {
						annex_country = {
							target = AHE
						}
						set_capital = { state = 4 }
						country_event = {
							id = demo_aus.1
							days = 25
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				## Socialist Victory ##
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = AHE
								is_ally_with = AHE
								is_in_faction_with = AHE
								is_subject_of = AHE
							}
						}
						ROOT = {
							original_tag = AUS
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					ROOT = {
						dismantle_faction = yes
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### Hungarian-Romanian War ###
				
				## Romania/Slovakia/Transylvania beats Hungary ##
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = ROM
								original_tag = TRS
								original_tag = SLO
							}
						}
						ROOT = {
							original_tag = HUN
						}
					}
					FROM = {
						white_peace = ROOT
					}
					
					HUN = {
						leave_faction = yes
					}
					if = {
						limit = {
							TRS = {
								has_country_flag = declared_war_on_HUN
							}
						}
						TRS = {
							add_state_core = 885
							transfer_state = 885
						}
					}
					if = {
						limit = {
							ROM = {
								has_country_flag = declared_war_on_HUN
							}
						}
						ROM = {
							annex_country = {
								target = TRS
							}
							every_owned_state = {
								limit = {
									has_core_of = TRS
								}
								add_core_of = ROM
								remove_core_of = TRS
							}
						}
					}
					if = {
						limit = {
							SLO = {
								has_country_flag = declared_war_on_HUN
							}
						}
						SLO = {
							transfer_state = 73
							transfer_state = 664
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				# Hungary beats Romania
				else_if = {
					limit = {
						FROM = {
							original_tag = HUN
						}
						ROOT = {
							original_tag = ROM
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					HUN = {
						81 = {
							set_demilitarized_zone = yes
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				# Hungary beats Slovakia
				else_if = {
					limit = {
						FROM = {
							original_tag = HUN
						}
						ROOT = {
							original_tag = SLO
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					HUN = {
						annex_country = {
							target = SLO
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				# Hungary beats Transylvania
				else_if = {
					limit = {
						FROM = {
							original_tag = HUN
						}
						ROOT = {
							original_tag = TRS
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					HUN = {
						annex_country = {
							target = TRS
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### Croatian-Serbian-Bosnian War ###
				else_if = {
					limit = {
						ROOT = {
							original_tag = SER
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					if = {
						limit = {
							FROM = {
								original_tag = CRO
							}
						}
						SER = {
							end_puppet = BOS
						}
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						ROOT = {
							original_tag = BOS
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					if = {
						limit = {
							FROM = {
								original_tag = CRO
							}
						}
						CRO = {
							annex_country = {
								target = BOS
							}
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = SER
								is_ally_with = SER
								is_in_faction_with = SER
								is_subject_of = SER
							}
						}
						ROOT = {
							original_tag = CRO
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					SER = {
						annex_country = {
							target = BOS
						}
						annex_country = {
							target = CRO
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### Romanian-Transylvanian War ###
				else_if = {
					limit = {
						FROM = {
							original_tag = ROM
						}
						ROOT = {
							original_tag = TRS
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = TRS
						}
						ROOT = {
							original_tag = ROM
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						set_cosmetic_tag = ROM_republic
						set_capital = { state = 46 }
						set_country_flag = can_integrate_ROM
					}
					set_global_flag = skip_default_capitulation
				}
				
				### IRISH CIVIL WAR ###
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = IRE
								tag = ICA
								tag = IRA
							}
						}
						ROOT = {
							OR = {
								original_tag = IRE
								tag = ICA
								tag = IRA
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### ITALIAN WARS ###
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = ITA
								is_in_faction_with = ITA
							}
						}
						ROOT = {
							original_tag = ETH
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						country_event = {
							id = italy_ethiopia_war.10
							days = 3
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = demo_ita.3 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = ITA
								is_in_faction_with = ITA
							}
						}
						ROOT = {
							original_tag = ALB
						}
					}
					ITA_peace_ALB_war = yes
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = ITA
								is_in_faction_with = ITA
							}
						}
						ROOT = {
							original_tag = GRE
						}
					}
					ITA_peace_GRE_war = yes
					set_global_flag = skip_default_capitulation
				}
				
				### CRISTERO WAR ###
				else_if = {
					limit = {
						FROM = {
							original_tag = MEX # mexican govt wins
						}
						ROOT = {
							OR = {
								original_tag = CRT
								original_tag = CMS
								original_tag = MTC
								original_tag = FRP
								original_tag = YUC
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = worldnews.10 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = CRT # cristeros win
						}
						ROOT = {
							OR = {
								original_tag = MEX
								original_tag = CMS
								original_tag = MTC
								original_tag = FRP
								original_tag = YUC
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						if = {
							limit = {
								NOT = {
									country_exists = MEX
									country_exists = CMS
									country_exists = MTC
									country_exists = FRP
								}
							}
							#set_cosmetic_tag = CRT_mexico
						}
					}
					random_other_country = {
						limit = { is_ai = yes }
						news_event = { id = worldnews.11 hours = 6 }
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = CMS
						}
						ROOT = {
							OR = {
								original_tag = MEX
								original_tag = CRT
								original_tag = MTC
								original_tag = FRP
								original_tag = YUC
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						if = {
							limit = {
								NOT = {
									country_exists = MEX
									country_exists = CRT
									country_exists = MTC
									country_exists = FRP
								}
							}
							#set_cosmetic_tag = CMS_mexico
						}
					}
					#random_other_country = {
					#	limit = { is_ai = yes }
					#	news_event = { id = demo_mex.5 hours = 6 }
					#}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = FRP
						}
						ROOT = {
							OR = {
								original_tag = MEX
								original_tag = CRT
								original_tag = MTC
								original_tag = CMS
								original_tag = YUC
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						if = {
							limit = {
								NOT = {
									country_exists = MEX
									country_exists = CRT
									country_exists = MTC
									country_exists = CMS
								}
							}
							#set_cosmetic_tag = FRP_mexico
							#set_capital = { state = 227 }
						}`
					}
					#random_other_country = {
					#	limit = { is_ai = yes }
					#	news_event = { id = demo_mex.5 hours = 6 }
					#}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = MTC
						}
						ROOT = {
							OR = {
								original_tag = MEX
								original_tag = CRT
								original_tag = FRP
								original_tag = CMS
								original_tag = YUC
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FROM = {
						annex_country = {
							target = ROOT
						}
						if = {
							limit = {
								NOT = {
									country_exists = MEX
									country_exists = CRT
									country_exists = FRP
									country_exists = CMS
								}
							}
							#set_cosmetic_tag = MTC_mexico
						}
					}
					#random_other_country = {
					#	limit = { is_ai = yes }
					#	news_event = { id = demo_mex.5 hours = 6 }
					#}
					set_global_flag = skip_default_capitulation
				}
				
				### CENTRAL AMERICA ###
				else_if = {
					limit = {
						FROM = {
							original_tag = CEN
						}
						ROOT = {
							original_tag = ELS
						}
					}
					FROM = {
						white_peace = ROOT
						annex_country = {
							target = ROOT
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### TURKEY WARS ###
				else_if = {
					limit = {
						FROM = {
							original_tag = TUR
						}
						ROOT = {
							original_tag = GEO
						}
					}
					FROM = {
						white_peace = ROOT
						transfer_state = 890
						transfer_state = 966
					}
					set_global_flag = skip_default_capitulation
				}
				
				else_if = {
					limit = {
						FROM = {
							original_tag = TUR
						}
						ROOT = {
							original_tag = IRQ
						}
					}
					FROM = {
						white_peace = ROOT
						puppet = ROOT
						transfer_state = 676
						transfer_state = 901
					}
					set_global_flag = skip_default_capitulation
				}
				
				else_if = {
					limit = {
						FROM = {
							original_tag = TUR
						}
						ROOT = {
							original_tag = SYR
						}
					}
					FROM = {
						white_peace = ROOT
						annex_country = {
							target = ROOT
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### PACIFIC WAR ###
				else_if = {
					limit = {
						FROM = {
							original_tag = JAP
						}
						ROOT = {
							original_tag = USA
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					HAW = {
						add_state_core = 629
						transfer_state = 629
						
						set_cosmetic_tag = HAW_mandate
					}
					JAP = {
						transfer_state = 630
						transfer_state = 631
						transfer_state = 632
						transfer_state = 638
						transfer_state = 642
						transfer_state = 650
						transfer_state = 727
						
						annex_country = {
							target = PHI
						}
						puppet = HAW
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = USA
						}
						ROOT = {
							original_tag = JAP
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					USA = {
						annex_country = {
							target = JAP
						}
						country_event = {
							id = united_states.200
							days = 3
						}
						country_event = {
							id = united_states.201
							days = 5
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				### SECOND GREAT WAR - WESTERN FRONT ###
				else_if = {
					limit = {
						FROM = {
							OR = {
								original_tag = FRA
								original_tag = SOV
							}
						}
						ROOT = {
							original_tag = GER
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					if = {
						limit = {
							original_tag = FRA
						}
						FRA = {
							FRA_wins_great_war = yes
						}
					}
					else_if = {
						limit = {
							original_tag = SOV
						}
						SOV = {
							SOV_wins_great_war = yes
						}
					}
					set_global_flag = skip_default_capitulation
				}
				else_if = {
					limit = {
						FROM = {
							original_tag = FRA
						}
						ROOT = {
							original_tag = SWI
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					FRA = {
						transfer_state = 3
					}
					set_global_flag = skip_default_capitulation
				}
				
				### SECOND GREAT WAR - EASTERN FRONT ###
				else_if = {
					limit = {
						FROM = {
							original_tag = SOV
						}
						ROOT = {
							OR = {
								original_tag = BAL
								original_tag = BLR
								original_tag = CRI
								original_tag = UKR
							}
						}
					}
					FROM = {
						diplomatic_relation = { country = ROOT relation = war_relation active = no }
					}
					ROOT = {
						diplomatic_relation = { country = FROM relation = war_relation active = no }
					}
					if = {
						limit = {
							ROOT = {
								original_tag = BAL
							}
						}
						SOV = {
							annex_country = {
								target = BAL
							}
							release_autonomy = {
								target = EST
								autonomy_state = autonomy_RL_occupied_puppet
								freedom_level = 0.5
							}
							release_autonomy = {
								target = LAT
								autonomy_state = autonomy_RL_occupied_puppet
								freedom_level = 0.5
							}
						}
					}
					else_if = {
						limit = {
							ROOT = {
								original_tag = BLR
							}
						}
						annex_country = {
							target = BLR
						}
					}
					else_if = {
						limit = {
							ROOT = {
								original_tag = CRI
							}
						}
						annex_country = {
							target = CRI
						}
					}
					else_if = {
						limit = {
							ROOT = {
								original_tag = UKR
							}
						}
						annex_country = {
							target = UKR
						}
					}
					set_global_flag = skip_default_capitulation
				}
				
				if = { # Fixing all wars vs puppets
					limit = {
						ROOT = {
							is_puppet = yes
							if = {
								limit = { is_puppet = yes }
								OVERLORD = { has_capitulated = no }
							}
						}
					}
					#log = "ended puppet"
					ROOT = { OVERLORD = { end_puppet = PREV } }
				}
			}
			else_if = {
				limit = {
					OR = {
						ROOT = { is_in_faction = yes }
						ROOT = {
							all_allied_country = {
								has_capitulated = no
							}
						}
					}
					NOT = {
						has_game_rule = {
							rule = SCRIPTED_PEACE
							option = SCRIPTED_PEACE_DISABLED
						}
					}
				}
				set_global_flag = war_continuing
			}
			clr_global_flag = skip_default_capitulation
			ROOT = {
				clr_country_flag = declared_war_on_@FROM
			}
		}
	}
}
